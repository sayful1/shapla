wp.customize.controlConstructor["shapla-background"]=wp.customize.Control.extend({ready:function(){"use strict";this.initKirkiControl()},initKirkiControl:function(){var e=this,t=e.setting._value,n=e.container.find(".shapla-color-control");(_.isUndefined(t["background-image"])||""===t["background-image"])&&(e.container.find(".background-wrapper > .background-repeat").hide(),e.container.find(".background-wrapper > .background-position").hide(),e.container.find(".background-wrapper > .background-size").hide(),e.container.find(".background-wrapper > .background-attachment").hide()),n.wpColorPicker({change:function(){setTimeout(function(){e.saveValue("background-color",n.val())},100)}}),e.container.on("change",".background-repeat select",function(){e.saveValue("background-repeat",jQuery(this).val())}),e.container.on("change click",".background-size input",function(){e.saveValue("background-size",jQuery(this).val())}),e.container.on("change",".background-position select",function(){e.saveValue("background-position",jQuery(this).val())}),e.container.on("change click",".background-attachment input",function(){e.saveValue("background-attachment",jQuery(this).val())}),e.container.on("click",".background-image-upload-button",function(t){var n=wp.media({multiple:!1}).open().on("select",function(){var t,a,i,o=n.state().get("selection").first(),r=o.toJSON().sizes.full.url;_.isUndefined(o.toJSON().sizes.medium)?_.isUndefined(o.toJSON().sizes.thumbnail)||(r=o.toJSON().sizes.thumbnail.url):r=o.toJSON().sizes.medium.url,t=o.toJSON().sizes.full.url,o.toJSON().id,o.toJSON().width,o.toJSON().height,""!==t&&e.container.find(".background-wrapper > .background-repeat, .background-wrapper > .background-position, .background-wrapper > .background-size, .background-wrapper > .background-attachment").show(),e.saveValue("background-image",t),a=e.container.find(".placeholder, .thumbnail"),i=e.container.find(".background-image-upload-remove-button"),a.length&&a.removeClass().addClass("thumbnail thumbnail-image").html('<img src="'+r+'" alt="" />'),i.length&&i.show()});t.preventDefault()}),e.container.on("click",".background-image-upload-remove-button",function(t){var n,a;t.preventDefault(),e.saveValue("background-image",""),n=e.container.find(".placeholder, .thumbnail"),a=e.container.find(".background-image-upload-remove-button"),e.container.find(".background-wrapper > .background-repeat").hide(),e.container.find(".background-wrapper > .background-position").hide(),e.container.find(".background-wrapper > .background-size").hide(),e.container.find(".background-wrapper > .background-attachment").hide(),n.length&&n.removeClass().addClass("placeholder").html("No file selected"),a.length&&a.hide()})},saveValue:function(e,t){var n=jQuery("#customize-control-"+this.id.replace("[","-").replace("]","")+" .background-hidden-value"),a=this.setting._value;a[e]=t,jQuery(n).attr("value",JSON.stringify(a)).trigger("change"),this.setting.set(a)}}),wp.customize.controlConstructor["shapla-color"]=wp.customize.Control.extend({ready:function(){"use strict";var e=this,t=this.container.find(".shapla-color-control");void 0!==e.params.choices&&t.wpColorPicker(e.params.choices),t.wpColorPicker({change:function(n,a){setTimeout(function(){e.setting.set(t.val())},100)}})}}),wp.customize.controlConstructor["shapla-dimensions"]=wp.customize.Control.extend({ready:function(){"use strict";var e,t=this.params.choices.controls,n={},a=[];for(_.each(t,function(e,t){!0===e&&a.push(t)}),e=0;e<a.length;e++)n[a[e]]=this.setting._value[a[e]],this.updateDimensionsValue(a[e],n)},updateDimensionsValue:function(e,t){var n=this;n.container.on("change keyup paste","."+e+" input",function(){t[e]=jQuery(this).val(),n.kirkiNotifications(),n.saveValue(t)})},saveValue:function(e){"use strict";var t={};_.each(e,function(e,n){t[n]=e}),this.setting.set(t)},kirkiNotifications:function(){var e=this;wp.customize(e.id,function(t){t.bind(function(n){var a,i="long_title",o={};t.notifications.remove(i),_.each(["top","bottom","left","right"],function(t){_.isUndefined(n[t])||(!1===e.kirkiValidateCSSValue(n[t])?o[t]=dimensionskirkiL10n[t]:delete o[t])}),_.isEmpty(o)?t.notifications.remove(i):(a=dimensionskirkiL10n["invalid-value"]+" ("+_.values(o).toString()+") ",t.notifications.add(i,new wp.customize.Notification(i,{type:"warning",message:a})))})})},kirkiValidateCSSValue:function(e){var t,n;return"0"===e||0<=e.indexOf("calc(")&&0<=e.indexOf(")")||(t=parseFloat(e),n=e.replace(t,""),!isNaN(t)&&-1!==jQuery.inArray(n,["rem","em","ex","%","px","cm","mm","in","pt","pc","ch","vh","vw","vmin","vmax"]))}}),wp.customize.controlConstructor["shapla-radio-buttonset"]=wp.customize.Control.extend({ready:function(){"use strict";var e=this;this.container.on("click","input",function(){e.setting.set(jQuery(this).val())})}}),wp.customize.controlConstructor["shapla-radio-image"]=wp.customize.Control.extend({ready:function(){"use strict";var e=this;this.container.on("click","input",function(){e.setting.set(jQuery(this).val())})}}),wp.customize.controlConstructor["shapla-slider"]=wp.customize.Control.extend({ready:function(){"use strict";var e,t,n,a,i=this;jQuery("input[type=range]").on("mousedown",function(){e=jQuery(this).attr("value"),jQuery(this).mousemove(function(){e=jQuery(this).attr("value"),jQuery(this).closest("label").find(".shapla_range_value .value").text(e)})}),jQuery(".shapla-slider-reset").click(function(){t=jQuery(this).closest("label").find("input"),n=t.data("reset_value"),t.val(n),t.change(),jQuery(this).closest("label").find(".shapla_range_value .value").text(n)}),a="postMessage"===i.setting.transport?"mousemove change":"change",this.container.on(a,"input",function(){i.setting.set(jQuery(this).val())})}}),wp.customize.controlConstructor["shapla-toggle"]=wp.customize.Control.extend({ready:function(){"use strict";var e=this,t=e.setting._value;this.container.on("change","input",function(){t=!!jQuery(this).is(":checked"),e.setting.set(t)})}}),wp.customize.controlConstructor["shapla-typography"]=wp.customize.Control.extend({ready:function(){"use strict";var e,t=this,n=t.setting._value;t.renderFontSelector(),t.renderBackupFontSelector(),t.renderVariantSelector(),t.params.default["font-size"]&&this.container.on("change keyup paste",".font-size input",function(){t.saveValue("font-size",jQuery(this).val())}),t.params.default["line-height"]&&this.container.on("change keyup paste",".line-height input",function(){t.saveValue("line-height",jQuery(this).val())}),t.params.default["margin-top"]&&this.container.on("change keyup paste",".margin-top input",function(){t.saveValue("margin-top",jQuery(this).val())}),t.params.default["margin-bottom"]&&this.container.on("change keyup paste",".margin-bottom input",function(){t.saveValue("margin-bottom",jQuery(this).val())}),t.params.default["letter-spacing"]&&(n["letter-spacing"]=jQuery.isNumeric(n["letter-spacing"])?n["letter-spacing"]+"px":n["letter-spacing"],this.container.on("change keyup paste",".letter-spacing input",function(){n["letter-spacing"]=jQuery.isNumeric(jQuery(this).val())?jQuery(this).val()+"px":jQuery(this).val(),t.saveValue("letter-spacing",n["letter-spacing"])})),t.params.default["word-spacing"]&&this.container.on("change keyup paste",".word-spacing input",function(){t.saveValue("word-spacing",jQuery(this).val())}),t.params.default["text-align"]&&this.container.on("change",".text-align input",function(){t.saveValue("text-align",jQuery(this).val())}),t.params.default["text-transform"]&&jQuery(t.selector+" .text-transform select").select2().on("change",function(){t.saveValue("text-transform",jQuery(this).val())}),t.params.default.color&&(e=this.container.find(".shapla-color-control")).wpColorPicker({change:function(){setTimeout(function(){t.saveValue("color",e.val())},100)}})},renderFontSelector:function(){var e,t=this,n=t.selector+" .font-family select",a=[],i=[],o=[],r=t.setting._value,s=t.getFonts();_.isUndefined(s.standard)||_.each(s.standard,function(e){i.push({id:e.family.replace(/&quot;/g,"&#39"),text:e.label})}),_.isUndefined(s.standard)||_.each(s.google,function(e){o.push({id:e.family,text:e.label})}),a=[{text:"Standard Fonts",children:i},{text:"Google Fonts",children:o}],e=jQuery(n).selectWoo({data:a}),r["font-family"]&&e.val(r["font-family"].replace(/'/g,'"')).trigger("change"),e.on("change",function(){t.saveValue("font-family",jQuery(this).val()),t.renderBackupFontSelector(),t.renderVariantSelector()})},renderBackupFontSelector:function(){var e,t=this,n=t.selector+" .font-backup select",a=[],i=t.setting._value,o=(i["font-family"],t.getFonts());(_.isUndefined(i["font-backup"])||null===i["font-backup"])&&(i["font-backup"]=""),jQuery(t.selector+" .font-backup").hide(),_.isUndefined(o.standard)||_.each(o.standard,function(e){a.push({id:e.family.replace(/&quot;/g,"&#39"),text:e.label})}),e=jQuery(n).selectWoo({data:a}),void 0!==i["font-backup"]&&e.val(i["font-backup"].replace(/'/g,'"')).trigger("change"),e.on("change",function(){t.saveValue("font-backup",jQuery(this).val())})},renderVariantSelector:function(){var e,t,n,a=this,i=a.setting._value,o=i["font-family"],r=a.selector+" .variant select",s=[],c=!1,u=a.getVariants(o);!1!==u?(jQuery(a.selector+" .variant").show(),_.each(u,function(e){i.variant===e.id&&(c=!0),s.push({id:e.id,text:e.label})}),c||(i.variant="regular"),jQuery(r).hasClass("select2-hidden-accessible")&&(jQuery(r).select2("destroy"),jQuery(r).empty()),(t=jQuery(r).select2({data:s})).val(i.variant).trigger("change"),t.on("change",function(){a.saveValue("variant",jQuery(this).val()),e=_.isString(i.variant)?i.variant.match(/\d/g):"400",e=_.isObject(e)?e.join(""):"400",n=-1!==i.variant.indexOf("italic")?"italic":"normal",a.saveValue("font-weight",e),a.saveValue("font-style",n)})):jQuery(a.selector+" .variant").hide()},renderSubsetSelector:function(){var e,t=this,n=t.getValue(),a=n["font-family"],i=t.getSubsets(a),o=t.selector+" .subsets select",r=[],s=n.subsets;!1!==i?(jQuery(t.selector+" .subsets").show(),_.each(i,function(e){_.isObject(s)&&-1===s.indexOf(e.id)&&(s=_.reject(s,function(t){return t===e.id})),r.push({id:e.id,text:e.label})})):jQuery(t.selector+" .subsets").hide(),jQuery(o).hasClass("select2-hidden-accessible")&&(jQuery(o).select2("destroy"),jQuery(o).empty()),(e=jQuery(o).select2({data:r})).val(s).trigger("change"),e.on("change",function(){t.saveValue("subsets",jQuery(this).val())})},getFonts:function(){return _.isUndefined(window["shaplaFonts"+this.id])?_.isUndefined(shaplaAllFonts)?{google:[],standard:[]}:shaplaAllFonts:window["shaplaFonts"+this.id]},getVariants:function(e){var t=this.getFonts(),n=!1;return _.each(t.standard,function(t){if(e&&t.family===e.replace(/'/g,'"'))return n=t.variants,t.variants}),_.each(t.google,function(t){if(t.family===e)return n=t.variants,t.variants}),n},getSubsets:function(e){var t=!1,n=this.getFonts();return _.each(n.google,function(n){n.family===e&&(t=n.subsets)}),t},getValue:function(){"use strict";var e=this.container.find(".typography-hidden-value"),t=jQuery(e).val();return JSON.parse(t)},saveValue:function(e,t){var n=this.container.find(".typography-hidden-value"),a=this.setting._value;a[e]=t,jQuery(n).attr("value",JSON.stringify(a)).trigger("change"),this.setting.set(a)}});